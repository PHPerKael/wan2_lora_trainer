{"id":"4ed76f5e-1c31-413e-9500-f33a1c1cb1a1","revision":0,"last_node_id":156,"last_link_id":289,"nodes":[{"id":148,"type":"Fast Groups Bypasser (rgthree)","pos":[-16333.8671875,-1695.5040283203125],"size":[558.3898315429688,130],"flags":{},"order":0,"mode":0,"inputs":[],"outputs":[{"name":"OPT_CONNECTION","type":"*","links":null}],"properties":{"matchColors":"","matchTitle":"","showNav":true,"sort":"position","customSortAlphabet":"","toggleRestriction":"default","widget_ue_connectable":{}}},{"id":136,"type":"Note","pos":[-14755.9130859375,-1560.3748779296875],"size":[300.7242736816406,88],"flags":{},"order":2,"mode":0,"inputs":[],"outputs":[],"title":"Clip vision note","properties":{"widget_ue_connectable":{}},"widgets_values":["Clip should be setted up to None for t2v models.\n\nIf you use blocks_to_swap. 30 is the max for 1.3B\nand 40 for the 14B models."],"color":"#432","bgcolor":"#653"},{"id":138,"type":"Note","pos":[-14753.26953125,-1428.6143798828125],"size":[295.977294921875,93.37679290771484],"flags":{},"order":3,"mode":0,"inputs":[],"outputs":[],"title":"MODEL TESTED : WAN 2.1 T2I","properties":{"widget_ue_connectable":{}},"widgets_values":["------------------------------------\nvae : Wan2_1_Vae (original)\nModel : WAN2_1 \nText encoder : unmt5-xxl-enc-bf16\n------------------------------------"],"color":"#432","bgcolor":"#653"},{"id":134,"type":"MusubiCompileSettings","pos":[-14752.4208984375,-1914.244140625],"size":[288.1060791015625,179.01524353027344],"flags":{},"order":4,"mode":0,"inputs":[{"localized_name":"fp8_base","name":"fp8_base","type":"BOOLEAN","widget":{"name":"fp8_base"},"link":null},{"localized_name":"fp8_scaled","name":"fp8_scaled","type":"BOOLEAN","widget":{"name":"fp8_scaled"},"link":null},{"localized_name":"dynamo_backend","name":"dynamo_backend","type":"COMBO","widget":{"name":"dynamo_backend"},"link":null},{"localized_name":"dynamo_mode","name":"dynamo_mode","type":"COMBO","widget":{"name":"dynamo_mode"},"link":null},{"localized_name":"dynamo_fullgraph","name":"dynamo_fullgraph","type":"BOOLEAN","widget":{"name":"dynamo_fullgraph"},"link":null},{"localized_name":"dynamo_dynamic","name":"dynamo_dynamic","type":"BOOLEAN","widget":{"name":"dynamo_dynamic"},"link":null}],"outputs":[{"localized_name":"compile_settings","name":"compile_settings","type":"DICT","links":[282]}],"properties":{"aux_id":"kohya-ss/musubi-tuner","ver":"ad8009914ade0847cdd6e6e99e60154c564adbdc","Node name for S&R":"MusubiCompileSettings","widget_ue_connectable":{}},"widgets_values":[false,false,"INDUCTOR","default",false,false],"color":"#432","bgcolor":"#653"},{"id":135,"type":"MusubiMemorySettings","pos":[-14754.646484375,-1685.4010009765625],"size":[295.4351501464844,82],"flags":{},"order":5,"mode":0,"inputs":[{"localized_name":"blocks_to_swap","name":"blocks_to_swap","type":"INT","widget":{"name":"blocks_to_swap"},"link":null},{"localized_name":"img_in_txt_in_offloading","name":"img_in_txt_in_offloading","type":"BOOLEAN","widget":{"name":"img_in_txt_in_offloading"},"link":null}],"outputs":[{"localized_name":"memory_settings","name":"memory_settings","type":"DICT","links":[283]}],"properties":{"aux_id":"kohya-ss/musubi-tuner","ver":"ad8009914ade0847cdd6e6e99e60154c564adbdc","Node name for S&R":"MusubiMemorySettings","widget_ue_connectable":{}},"widgets_values":[30,true],"color":"#432","bgcolor":"#653"},{"id":137,"type":"WanLoRATrainer","pos":[-14399.7734375,-1963.4058837890625],"size":[400,1048],"flags":{},"order":12,"mode":0,"inputs":[{"localized_name":"dataset_config_toml","name":"dataset_config_toml","type":"STRING","link":280},{"localized_name":"trigger_in","name":"trigger_in","type":"*","link":281},{"localized_name":"compile_settings","name":"compile_settings","shape":7,"type":"DICT","link":282},{"localized_name":"memory_settings","name":"memory_settings","shape":7,"type":"DICT","link":283},{"localized_name":"dit_name","name":"dit_name","type":"COMBO","widget":{"name":"dit_name"},"link":null},{"localized_name":"vae_name","name":"vae_name","type":"COMBO","widget":{"name":"vae_name"},"link":null},{"localized_name":"t5_name","name":"t5_name","type":"COMBO","widget":{"name":"t5_name"},"link":null},{"localized_name":"clip_name","name":"clip_name","type":"COMBO","widget":{"name":"clip_name"},"link":null},{"localized_name":"output_dir","name":"output_dir","type":"STRING","widget":{"name":"output_dir"},"link":null},{"localized_name":"output_name","name":"output_name","type":"STRING","widget":{"name":"output_name"},"link":null},{"localized_name":"task","name":"task","type":"COMBO","widget":{"name":"task"},"link":null},{"localized_name":"max_train_steps","name":"max_train_steps","type":"INT","widget":{"name":"max_train_steps"},"link":null},{"localized_name":"learning_rate","name":"learning_rate","type":"FLOAT","widget":{"name":"learning_rate"},"link":null},{"localized_name":"optimizer_type","name":"optimizer_type","type":"COMBO","widget":{"name":"optimizer_type"},"link":null},{"localized_name":"lr_scheduler","name":"lr_scheduler","type":"COMBO","widget":{"name":"lr_scheduler"},"link":null},{"localized_name":"network_module","name":"network_module","type":"COMBO","widget":{"name":"network_module"},"link":null},{"localized_name":"network_dim","name":"network_dim","type":"INT","widget":{"name":"network_dim"},"link":null},{"localized_name":"network_alpha","name":"network_alpha","type":"FLOAT","widget":{"name":"network_alpha"},"link":null},{"localized_name":"network_dropout","name":"network_dropout","type":"FLOAT","widget":{"name":"network_dropout"},"link":null},{"localized_name":"mixed_precision","name":"mixed_precision","type":"COMBO","widget":{"name":"mixed_precision"},"link":null},{"localized_name":"gradient_accumulation_steps","name":"gradient_accumulation_steps","type":"INT","widget":{"name":"gradient_accumulation_steps"},"link":null},{"localized_name":"gradient_checkpointing","name":"gradient_checkpointing","type":"BOOLEAN","widget":{"name":"gradient_checkpointing"},"link":null},{"localized_name":"seed","name":"seed","type":"INT","widget":{"name":"seed"},"link":null},{"localized_name":"attn_mode","name":"attn_mode","type":"COMBO","widget":{"name":"attn_mode"},"link":null},{"localized_name":"split_attn","name":"split_attn","type":"BOOLEAN","widget":{"name":"split_attn"},"link":null},{"localized_name":"fp8_t5","name":"fp8_t5","type":"BOOLEAN","widget":{"name":"fp8_t5"},"link":null},{"localized_name":"vae_dtype","name":"vae_dtype","type":"COMBO","widget":{"name":"vae_dtype"},"link":null},{"localized_name":"max_data_loader_n_workers","name":"max_data_loader_n_workers","type":"INT","widget":{"name":"max_data_loader_n_workers"},"link":null},{"localized_name":"persistent_data_loader_workers","name":"persistent_data_loader_workers","type":"BOOLEAN","widget":{"name":"persistent_data_loader_workers"},"link":null},{"localized_name":"save_every_n_steps","name":"save_every_n_steps","type":"INT","widget":{"name":"save_every_n_steps"},"link":null},{"localized_name":"save_every_n_epochs","name":"save_every_n_epochs","type":"INT","widget":{"name":"save_every_n_epochs"},"link":null},{"localized_name":"save_state","name":"save_state","type":"BOOLEAN","widget":{"name":"save_state"},"link":null},{"localized_name":"scale_weight_norms","name":"scale_weight_norms","type":"FLOAT","widget":{"name":"scale_weight_norms"},"link":null},{"localized_name":"timestep_sampling","name":"timestep_sampling","type":"COMBO","widget":{"name":"timestep_sampling"},"link":null},{"localized_name":"discrete_flow_shift","name":"discrete_flow_shift","type":"FLOAT","widget":{"name":"discrete_flow_shift"},"link":null},{"localized_name":"network_args_str","name":"network_args_str","shape":7,"type":"STRING","widget":{"name":"network_args_str"},"link":null},{"localized_name":"optimizer_args_str","name":"optimizer_args_str","shape":7,"type":"STRING","widget":{"name":"optimizer_args_str"},"link":null},{"localized_name":"network_weights_path","name":"network_weights_path","shape":7,"type":"STRING","widget":{"name":"network_weights_path"},"link":null},{"localized_name":"training_comment","name":"training_comment","shape":7,"type":"STRING","widget":{"name":"training_comment"},"link":null}],"outputs":[{"localized_name":"lora_filepath","name":"lora_filepath","type":"STRING","links":[286]},{"localized_name":"status_message","name":"status_message","type":"STRING","links":[287]}],"properties":{"aux_id":"kohya-ss/musubi-tuner","ver":"ad8009914ade0847cdd6e6e99e60154c564adbdc","Node name for S&R":"WanLoRATrainer","widget_ue_connectable":{}},"widgets_values":["wan2.1_t2v_1.3B_fp16.safetensors","wan_2.1_vae.safetensors","umt5-xxl-enc-bf16.safetensors","None","relative_output_path","your_lora_name","t2v-1.3B",2000,0.00001,"AdamW8bit","cosine","networks.lora_wan",16,2,0.2,"fp16",1,true,777,"fixed","sageattn",false,false,"float16",2,true,0,1,false,0,"sigma",1,"","","",""],"color":"#233","bgcolor":"#355"},{"id":149,"type":"Note","pos":[-14769.2568359375,-2117.312255859375],"size":[1312.2711181640625,95.086181640625],"flags":{},"order":7,"mode":0,"inputs":[],"outputs":[],"title":"VISUAL STUDIO IN COMFYUI .bat IF YOU USE MUSUBI COMPILE SETTINGS (optional)  [Musubi-tuner runs in comfy but with another subprocess and can use multiple cores with _n_workers, (faster)]","properties":{"widget_ue_connectable":{}},"widgets_values":["@echo off\nREM Load Visual Studio Build Tools for the Wan subprocess environment ([Optional] to Compile with Musubi Compile Settings and block swap, recomended for big models in low ram)\ncall \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Auxiliary\\Build\\vcvarsall.bat\" amd64\nREM Start ComfyUI\n.\\python_embeded\\python.exe -s ComfyUI\\main.py --windows-standalone-build --fast fp16_accumulation\npause\n"],"color":"#432","bgcolor":"#653"},{"id":153,"type":"ShowText|pysssss","pos":[-13927.1904296875,-1958.8402099609375],"size":[345.4878234863281,82.95586395263672],"flags":{},"order":14,"mode":0,"inputs":[{"localized_name":"text","name":"text","type":"STRING","link":286}],"outputs":[{"localized_name":"STRING","name":"STRING","shape":6,"type":"STRING","links":null}],"title":"Where the lora is saved","properties":{"cnr_id":"comfyui-custom-scripts","ver":"1.2.5","widget_ue_connectable":{},"Node name for S&R":"ShowText|pysssss"}},{"id":154,"type":"ShowText|pysssss","pos":[-13921.71875,-1817.4078369140625],"size":[336.5535583496094,120.92643737792969],"flags":{},"order":15,"mode":0,"inputs":[{"localized_name":"text","name":"text","type":"STRING","link":287}],"outputs":[{"localized_name":"STRING","name":"STRING","shape":6,"type":"STRING","links":null}],"title":"Ending log","properties":{"cnr_id":"comfyui-custom-scripts","ver":"1.2.5","widget_ue_connectable":{},"Node name for S&R":"ShowText|pysssss"}},{"id":155,"type":"ShowText|pysssss","pos":[-15274.59375,-1742.3330078125],"size":[434.830322265625,155.54666137695312],"flags":{},"order":13,"mode":0,"inputs":[{"localized_name":"text","name":"text","type":"STRING","link":288}],"outputs":[{"localized_name":"STRING","name":"STRING","shape":6,"type":"STRING","links":null}],"title":"TEXT CACHE LOG","properties":{"cnr_id":"comfyui-custom-scripts","ver":"1.2.5","widget_ue_connectable":{},"Node name for S&R":"ShowText|pysssss"}},{"id":156,"type":"ShowText|pysssss","pos":[-15701.4697265625,-1737.108642578125],"size":[386.8087158203125,154.4298858642578],"flags":{},"order":11,"mode":0,"inputs":[{"localized_name":"text","name":"text","type":"STRING","link":289}],"outputs":[{"localized_name":"STRING","name":"STRING","shape":6,"type":"STRING","links":null}],"title":"LATENT CACHE LOG","properties":{"cnr_id":"comfyui-custom-scripts","ver":"1.2.5","widget_ue_connectable":{},"Node name for S&R":"ShowText|pysssss"}},{"id":125,"type":"WanCacheLatents","pos":[-15710.7568359375,-2117.95703125],"size":[396.0140686035156,334.6712646484375],"flags":{},"order":9,"mode":0,"inputs":[{"localized_name":"dataset_config_toml","name":"dataset_config_toml","type":"STRING","link":253},{"localized_name":"trigger_in","name":"trigger_in","type":"*","link":254},{"localized_name":"vae_name","name":"vae_name","type":"COMBO","widget":{"name":"vae_name"},"link":null},{"localized_name":"vae_dtype","name":"vae_dtype","type":"COMBO","widget":{"name":"vae_dtype"},"link":null},{"localized_name":"device","name":"device","type":"COMBO","widget":{"name":"device"},"link":null},{"localized_name":"batch_size_override","name":"batch_size_override","type":"INT","widget":{"name":"batch_size_override"},"link":null},{"localized_name":"num_workers_override","name":"num_workers_override","type":"INT","widget":{"name":"num_workers_override"},"link":null},{"localized_name":"skip_existing","name":"skip_existing","type":"BOOLEAN","widget":{"name":"skip_existing"},"link":null},{"localized_name":"keep_cache","name":"keep_cache","type":"BOOLEAN","widget":{"name":"keep_cache"},"link":null},{"localized_name":"vae_cache_cpu","name":"vae_cache_cpu","type":"BOOLEAN","widget":{"name":"vae_cache_cpu"},"link":null},{"localized_name":"clip_name","name":"clip_name","type":"COMBO","widget":{"name":"clip_name"},"link":null}],"outputs":[{"localized_name":"dataset_toml_path","name":"dataset_toml_path","type":"STRING","links":[255]},{"localized_name":"trigger_out","name":"trigger_out","type":"*","links":[256]},{"localized_name":"status_message","name":"status_message","type":"STRING","links":[289]}],"properties":{"aux_id":"kohya-ss/musubi-tuner","ver":"ad8009914ade0847cdd6e6e99e60154c564adbdc","Node name for S&R":"WanCacheLatents","widget_ue_connectable":{}},"widgets_values":["wan_2.1_vae.safetensors","float16","cuda",16,2,false,true,true,"None"],"color":"#323","bgcolor":"#535"},{"id":127,"type":"WanCacheTextEncoder","pos":[-15286.3193359375,-2118.90673828125],"size":[451.3213806152344,312.8648986816406],"flags":{},"order":10,"mode":0,"inputs":[{"localized_name":"dataset_config_toml","name":"dataset_config_toml","type":"STRING","link":255},{"localized_name":"trigger_in","name":"trigger_in","type":"*","link":256},{"localized_name":"t5_name","name":"t5_name","type":"COMBO","widget":{"name":"t5_name"},"link":null},{"localized_name":"fp8_t5","name":"fp8_t5","type":"BOOLEAN","widget":{"name":"fp8_t5"},"link":null},{"localized_name":"device","name":"device","type":"COMBO","widget":{"name":"device"},"link":null},{"localized_name":"batch_size_override","name":"batch_size_override","type":"INT","widget":{"name":"batch_size_override"},"link":null},{"localized_name":"num_workers_override","name":"num_workers_override","type":"INT","widget":{"name":"num_workers_override"},"link":null},{"localized_name":"skip_existing","name":"skip_existing","type":"BOOLEAN","widget":{"name":"skip_existing"},"link":null},{"localized_name":"keep_cache","name":"keep_cache","type":"BOOLEAN","widget":{"name":"keep_cache"},"link":null}],"outputs":[{"localized_name":"dataset_toml_path","name":"dataset_toml_path","type":"STRING","links":[280]},{"localized_name":"trigger_out","name":"trigger_out","type":"*","links":[281]},{"localized_name":"status_message","name":"status_message","type":"STRING","links":[288]}],"properties":{"aux_id":"kohya-ss/musubi-tuner","ver":"ad8009914ade0847cdd6e6e99e60154c564adbdc","Node name for S&R":"WanCacheTextEncoder","widget_ue_connectable":{}},"widgets_values":["umt5-xxl-enc-bf16.safetensors",false,"cuda",2,2,false,true],"color":"#232","bgcolor":"#353"},{"id":126,"type":"WanDatasetConfig","pos":[-16348.4150390625,-2112.51416015625],"size":[577.527099609375,375.53668212890625],"flags":{},"order":8,"mode":0,"inputs":[{"localized_name":"output_filename_prefix","name":"output_filename_prefix","type":"STRING","widget":{"name":"output_filename_prefix"},"link":null},{"localized_name":"general_resolution_width","name":"general_resolution_width","type":"INT","widget":{"name":"general_resolution_width"},"link":null},{"localized_name":"general_resolution_height","name":"general_resolution_height","type":"INT","widget":{"name":"general_resolution_height"},"link":null},{"localized_name":"general_caption_extension","name":"general_caption_extension","type":"STRING","widget":{"name":"general_caption_extension"},"link":null},{"localized_name":"general_batch_size","name":"general_batch_size","type":"INT","widget":{"name":"general_batch_size"},"link":null},{"localized_name":"general_enable_bucket","name":"general_enable_bucket","type":"BOOLEAN","widget":{"name":"general_enable_bucket"},"link":null},{"localized_name":"general_bucket_no_upscale","name":"general_bucket_no_upscale","type":"BOOLEAN","widget":{"name":"general_bucket_no_upscale"},"link":null},{"localized_name":"dataset1_image_directory","name":"dataset1_image_directory","type":"STRING","widget":{"name":"dataset1_image_directory"},"link":null},{"localized_name":"dataset1_cache_directory","name":"dataset1_cache_directory","type":"STRING","widget":{"name":"dataset1_cache_directory"},"link":null},{"localized_name":"dataset1_num_repeats","name":"dataset1_num_repeats","type":"INT","widget":{"name":"dataset1_num_repeats"},"link":null},{"localized_name":"dataset1_override_resolution","name":"dataset1_override_resolution","type":"BOOLEAN","widget":{"name":"dataset1_override_resolution"},"link":null},{"localized_name":"dataset1_resolution_width","name":"dataset1_resolution_width","type":"INT","widget":{"name":"dataset1_resolution_width"},"link":null},{"localized_name":"dataset1_resolution_height","name":"dataset1_resolution_height","type":"INT","widget":{"name":"dataset1_resolution_height"},"link":null}],"outputs":[{"localized_name":"dataset_toml_path","name":"dataset_toml_path","type":"STRING","links":[253]},{"localized_name":"trigger_out","name":"trigger_out","type":"*","links":[254]}],"properties":{"aux_id":"kohya-ss/musubi-tuner","ver":"ad8009914ade0847cdd6e6e99e60154c564adbdc","Node name for S&R":"WanDatasetConfig","widget_ue_connectable":{}},"widgets_values":["musubi_dataset_config",512,512,".txt",1,true,true,"path to images/text caption","path to store the cache",1,true,512,512],"color":"#323","bgcolor":"#535"},{"id":152,"type":"Note","pos":[-14758.4580078125,-1275.4136962890625],"size":[305.4122619628906,107.65616607666016],"flags":{},"order":6,"mode":0,"inputs":[],"outputs":[],"title":"MODEL TESTED : I2V 14B Fp8 e4m3nf","properties":{"widget_ue_connectable":{}},"widgets_values":["-----------------------------------------\nvae : Wan2_1_Vae (original)\nModel : I2V 14B fp8 e4m3nf\nText encoder : unmt5-xxl-enc-bf16\nClip : roberta 14 huge pth (4gb version)\n-----------------------------------------"],"color":"#432","bgcolor":"#653"},{"id":151,"type":"Note","pos":[-14750.015625,-1084.0128173828125],"size":[293.232666015625,128.53916931152344],"flags":{},"order":1,"mode":0,"inputs":[],"outputs":[],"title":"Documentation","properties":{"widget_ue_connectable":{}},"widgets_values":["Musibi tunner Wan documentation:\n\nhttps://github.com/kohya-ss/musubi-tuner/blob/main/docs/wan.md"],"color":"#432","bgcolor":"#653"}],"links":[[253,126,0,125,0,"STRING"],[254,126,1,125,1,"*"],[255,125,0,127,0,"STRING"],[256,125,1,127,1,"*"],[280,127,0,137,0,"STRING"],[281,127,1,137,1,"*"],[282,134,0,137,2,"DICT"],[283,135,0,137,3,"DICT"],[286,137,0,153,0,"STRING"],[287,137,1,154,0,"STRING"],[288,127,2,155,0,"STRING"],[289,125,2,156,0,"STRING"]],"groups":[{"id":1,"title":"PRE-CACHING. YOU CAN SKIP AFTER GENERATION.","bounding":[-15731.8359375,-2196.345458984375,920.3976440429688,636.7136840820312],"color":"#8A8","font_size":24,"flags":{}},{"id":2,"title":"TRAINING","bounding":[-14796.2548828125,-2192.201171875,1343.2088623046875,1297.3646240234375],"color":"#8AA","font_size":24,"flags":{}},{"id":3,"title":"TOM AUTO-GEN__ Always ON for trigger","bounding":[-16367.0068359375,-2190.798583984375,620.541748046875,627.3327026367188],"color":"#b06634","font_size":24,"flags":{}}],"config":{},"extra":{"ds":{"scale":0.8140274938684475,"offset":[16120.967596292754,2034.698649601542]},"ue_links":[],"links_added_by_ue":[]},"version":0.4}