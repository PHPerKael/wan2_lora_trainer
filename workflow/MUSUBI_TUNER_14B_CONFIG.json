{"id":"e45504a0-fcb2-4e77-bd00-9ea1f14e1b37","revision":0,"last_node_id":175,"last_link_id":363,"nodes":[{"id":149,"type":"Note","pos":[-14769.2568359375,-2117.312255859375],"size":[1291.47265625,88],"flags":{},"order":0,"mode":0,"inputs":[],"outputs":[],"title":"VISUAL STUDIO IN COMFYUI .bat IF YOU USE MUSUBI COMPILE SETTINGS  [Musubi-tuner runs in comfy but with another subprocess and can use multiple cores with _n_workers, (faster)]","properties":{"widget_ue_connectable":{}},"widgets_values":["@echo off\nREM Load Visual Studio Build Tools for the Wan subprocess environment (Needed for Musubi WanTrainerLora to compile with Torch if you use the train settings)\ncall \"C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Auxiliary\\Build\\vcvarsall.bat\" amd64\nREM Start ComfyUI\n.\\python_embeded\\python.exe -s ComfyUI\\main.py --windows-standalone-build\npause\n"],"color":"#432","bgcolor":"#653"},{"id":128,"type":"ShowText|pysssss","pos":[-15701.4697265625,-1737.108642578125],"size":[385.3792419433594,160.62620544433594],"flags":{},"order":10,"mode":0,"inputs":[{"localized_name":"text","name":"text","type":"STRING","link":355}],"outputs":[{"localized_name":"STRING","name":"STRING","shape":6,"type":"STRING","links":null}],"title":"CACHE LATENT OUTPUT","properties":{"cnr_id":"comfyui-custom-scripts","ver":"1.2.5","Node name for S&R":"ShowText|pysssss","widget_ue_connectable":{}},"widgets_values":["Wan latent caching completed."],"color":"#323","bgcolor":"#535"},{"id":129,"type":"ShowText|pysssss","pos":[-15274.59375,-1739.4903564453125],"size":[436.01190185546875,162.7364959716797],"flags":{},"order":12,"mode":0,"inputs":[{"localized_name":"text","name":"text","type":"STRING","link":356}],"outputs":[{"localized_name":"STRING","name":"STRING","shape":6,"type":"STRING","links":null}],"title":"CACHE TEXT OUTPUT","properties":{"cnr_id":"comfyui-custom-scripts","ver":"1.2.5","Node name for S&R":"ShowText|pysssss","widget_ue_connectable":{}},"widgets_values":["Starting Wan text encoder caching..."],"color":"#232","bgcolor":"#353"},{"id":148,"type":"Fast Groups Bypasser (rgthree)","pos":[-16333.8671875,-1695.5040283203125],"size":[558.3898315429688,130],"flags":{},"order":1,"mode":0,"inputs":[],"outputs":[{"name":"OPT_CONNECTION","type":"*","links":null}],"properties":{"matchColors":"","matchTitle":"","showNav":true,"sort":"position","customSortAlphabet":"","toggleRestriction":"default","widget_ue_connectable":{}}},{"id":131,"type":"ShowText|pysssss","pos":[-13832.626953125,-1806.8433837890625],"size":[278.13189697265625,107.800537109375],"flags":{},"order":14,"mode":0,"inputs":[{"localized_name":"text","name":"text","type":"STRING","link":363}],"outputs":[{"localized_name":"STRING","name":"STRING","shape":6,"type":"STRING","links":null}],"title":"CONSOLE OUTPUT","properties":{"cnr_id":"comfyui-custom-scripts","ver":"1.2.5","Node name for S&R":"ShowText|pysssss","widget_ue_connectable":{}},"widgets_values":["ERROR: Training subprocess failed with return code 1. See logs above for details."],"color":"#233","bgcolor":"#355"},{"id":130,"type":"ShowText|pysssss","pos":[-13829.154296875,-1972.3758544921875],"size":[268.6341857910156,108.26958465576172],"flags":{},"order":13,"mode":0,"inputs":[{"localized_name":"text","name":"text","type":"STRING","link":362}],"outputs":[{"localized_name":"STRING","name":"STRING","shape":6,"type":"STRING","links":null}],"title":"LORA FILEPATH","properties":{"cnr_id":"comfyui-custom-scripts","ver":"1.2.5","Node name for S&R":"ShowText|pysssss","widget_ue_connectable":{}},"widgets_values":["B:\\ComfyUI\\ComfyUI\\output\\musubi_loras\\LoraTest14BXformers.safetensors"],"color":"#233","bgcolor":"#355"},{"id":174,"type":"MusubiMemorySettings","pos":[-14753.4619140625,-1715.7908935546875],"size":[295.4351501464844,82],"flags":{},"order":2,"mode":0,"inputs":[{"localized_name":"blocks_to_swap","name":"blocks_to_swap","type":"INT","widget":{"name":"blocks_to_swap"},"link":null},{"localized_name":"img_in_txt_in_offloading","name":"img_in_txt_in_offloading","type":"BOOLEAN","widget":{"name":"img_in_txt_in_offloading"},"link":null}],"outputs":[{"localized_name":"memory_settings","name":"memory_settings","type":"DICT","links":[360]}],"properties":{"Node name for S&R":"MusubiMemorySettings","widget_ue_connectable":{}},"widgets_values":[38,false],"color":"#432","bgcolor":"#653"},{"id":151,"type":"Note","pos":[-14750.9794921875,-1140.0208740234375],"size":[240.40890502929688,88],"flags":{},"order":3,"mode":0,"inputs":[],"outputs":[],"title":"Documentation","properties":{"widget_ue_connectable":{}},"widgets_values":["Musibi tunner Wan documentation:\n\nhttps://github.com/kohya-ss/musubi-tuner/blob/main/docs/wan.md"],"color":"#432","bgcolor":"#653"},{"id":171,"type":"WanCacheTextEncoder","pos":[-15233.6640625,-2080.54296875],"size":[315.6831970214844,242],"flags":{},"order":9,"mode":0,"inputs":[{"localized_name":"dataset_config_toml","name":"dataset_config_toml","type":"STRING","link":352},{"localized_name":"trigger_in","name":"trigger_in","type":"*","link":353},{"localized_name":"t5_name","name":"t5_name","type":"COMBO","widget":{"name":"t5_name"},"link":null},{"localized_name":"fp8_t5","name":"fp8_t5","type":"BOOLEAN","widget":{"name":"fp8_t5"},"link":null},{"localized_name":"device","name":"device","type":"COMBO","widget":{"name":"device"},"link":null},{"localized_name":"batch_size_override","name":"batch_size_override","type":"INT","widget":{"name":"batch_size_override"},"link":null},{"localized_name":"num_workers_override","name":"num_workers_override","type":"INT","widget":{"name":"num_workers_override"},"link":null},{"localized_name":"skip_existing","name":"skip_existing","type":"BOOLEAN","widget":{"name":"skip_existing"},"link":null},{"localized_name":"keep_cache","name":"keep_cache","type":"BOOLEAN","widget":{"name":"keep_cache"},"link":null}],"outputs":[{"localized_name":"dataset_toml_path","name":"dataset_toml_path","type":"STRING","links":[357]},{"localized_name":"trigger_out","name":"trigger_out","type":"*","links":[358]},{"localized_name":"status_message","name":"status_message","type":"STRING","links":[356]}],"properties":{"Node name for S&R":"WanCacheTextEncoder","widget_ue_connectable":{}},"widgets_values":["umt5-xxl-enc-bf16.safetensors",false,"cuda",2,2,false,true],"color":"#232","bgcolor":"#353"},{"id":170,"type":"WanCacheLatents","pos":[-15683.685546875,-2092.290771484375],"size":[352.2523498535156,290],"flags":{},"order":8,"mode":0,"inputs":[{"localized_name":"dataset_config_toml","name":"dataset_config_toml","type":"STRING","link":351},{"localized_name":"trigger_in","name":"trigger_in","type":"*","link":354},{"localized_name":"vae_name","name":"vae_name","type":"COMBO","widget":{"name":"vae_name"},"link":null},{"localized_name":"vae_dtype","name":"vae_dtype","type":"COMBO","widget":{"name":"vae_dtype"},"link":null},{"localized_name":"device","name":"device","type":"COMBO","widget":{"name":"device"},"link":null},{"localized_name":"batch_size_override","name":"batch_size_override","type":"INT","widget":{"name":"batch_size_override"},"link":null},{"localized_name":"num_workers_override","name":"num_workers_override","type":"INT","widget":{"name":"num_workers_override"},"link":null},{"localized_name":"skip_existing","name":"skip_existing","type":"BOOLEAN","widget":{"name":"skip_existing"},"link":null},{"localized_name":"keep_cache","name":"keep_cache","type":"BOOLEAN","widget":{"name":"keep_cache"},"link":null},{"localized_name":"vae_cache_cpu","name":"vae_cache_cpu","type":"BOOLEAN","widget":{"name":"vae_cache_cpu"},"link":null},{"localized_name":"clip_name","name":"clip_name","type":"COMBO","widget":{"name":"clip_name"},"link":null}],"outputs":[{"localized_name":"dataset_toml_path","name":"dataset_toml_path","type":"STRING","links":[352]},{"localized_name":"trigger_out","name":"trigger_out","type":"*","links":[353]},{"localized_name":"status_message","name":"status_message","type":"STRING","links":[355]}],"properties":{"Node name for S&R":"WanCacheLatents","widget_ue_connectable":{}},"widgets_values":["wan_2.1_vae.safetensors","float16","cuda",16,2,false,true,false,"None"],"color":"#323","bgcolor":"#535"},{"id":173,"type":"MusubiCompileSettings","pos":[-14760.181640625,-1956.986083984375],"size":[296.2281188964844,178],"flags":{},"order":4,"mode":0,"inputs":[{"localized_name":"fp8_base","name":"fp8_base","type":"BOOLEAN","widget":{"name":"fp8_base"},"link":null},{"localized_name":"fp8_scaled","name":"fp8_scaled","type":"BOOLEAN","widget":{"name":"fp8_scaled"},"link":null},{"localized_name":"dynamo_backend","name":"dynamo_backend","type":"COMBO","widget":{"name":"dynamo_backend"},"link":null},{"localized_name":"dynamo_mode","name":"dynamo_mode","type":"COMBO","widget":{"name":"dynamo_mode"},"link":null},{"localized_name":"dynamo_fullgraph","name":"dynamo_fullgraph","type":"BOOLEAN","widget":{"name":"dynamo_fullgraph"},"link":null},{"localized_name":"dynamo_dynamic","name":"dynamo_dynamic","type":"BOOLEAN","widget":{"name":"dynamo_dynamic"},"link":null}],"outputs":[{"localized_name":"compile_settings","name":"compile_settings","type":"DICT","links":[359]}],"properties":{"Node name for S&R":"MusubiCompileSettings","widget_ue_connectable":{}},"widgets_values":[false,false,"EAGER","default",false,false],"color":"#432","bgcolor":"#653"},{"id":169,"type":"WanDatasetConfig","pos":[-16338.6806640625,-2110.34375],"size":[526.8970336914062,366],"flags":{},"order":5,"mode":0,"inputs":[{"localized_name":"output_filename_prefix","name":"output_filename_prefix","type":"STRING","widget":{"name":"output_filename_prefix"},"link":null},{"localized_name":"general_resolution_width","name":"general_resolution_width","type":"INT","widget":{"name":"general_resolution_width"},"link":null},{"localized_name":"general_resolution_height","name":"general_resolution_height","type":"INT","widget":{"name":"general_resolution_height"},"link":null},{"localized_name":"general_caption_extension","name":"general_caption_extension","type":"STRING","widget":{"name":"general_caption_extension"},"link":null},{"localized_name":"general_batch_size","name":"general_batch_size","type":"INT","widget":{"name":"general_batch_size"},"link":null},{"localized_name":"general_enable_bucket","name":"general_enable_bucket","type":"BOOLEAN","widget":{"name":"general_enable_bucket"},"link":null},{"localized_name":"general_bucket_no_upscale","name":"general_bucket_no_upscale","type":"BOOLEAN","widget":{"name":"general_bucket_no_upscale"},"link":null},{"localized_name":"dataset1_image_directory","name":"dataset1_image_directory","type":"STRING","widget":{"name":"dataset1_image_directory"},"link":null},{"localized_name":"dataset1_cache_directory","name":"dataset1_cache_directory","type":"STRING","widget":{"name":"dataset1_cache_directory"},"link":null},{"localized_name":"dataset1_num_repeats","name":"dataset1_num_repeats","type":"INT","widget":{"name":"dataset1_num_repeats"},"link":null},{"localized_name":"dataset1_override_resolution","name":"dataset1_override_resolution","type":"BOOLEAN","widget":{"name":"dataset1_override_resolution"},"link":null},{"localized_name":"dataset1_resolution_width","name":"dataset1_resolution_width","type":"INT","widget":{"name":"dataset1_resolution_width"},"link":null},{"localized_name":"dataset1_resolution_height","name":"dataset1_resolution_height","type":"INT","widget":{"name":"dataset1_resolution_height"},"link":null}],"outputs":[{"localized_name":"dataset_toml_path","name":"dataset_toml_path","type":"STRING","links":[351]},{"localized_name":"trigger_out","name":"trigger_out","type":"*","links":[354]}],"properties":{"Node name for S&R":"WanDatasetConfig","widget_ue_connectable":{}},"widgets_values":["musubi_dataset_config",512,512,".txt",1,true,true,"image_and_text_path","empty_folder_to_store_cache",1,true,1024,1024],"color":"#323","bgcolor":"#535"},{"id":175,"type":"MusubiSamplingSettings","pos":[-14771.1396484375,-1575.648681640625],"size":[338.5770263671875,232],"flags":{},"order":6,"mode":0,"inputs":[{"localized_name":"sample_every_n_steps","name":"sample_every_n_steps","type":"INT","widget":{"name":"sample_every_n_steps"},"link":null},{"localized_name":"sample_every_n_epochs","name":"sample_every_n_epochs","type":"INT","widget":{"name":"sample_every_n_epochs"},"link":null},{"localized_name":"sample_at_first","name":"sample_at_first","type":"BOOLEAN","widget":{"name":"sample_at_first"},"link":null},{"localized_name":"vae_name","name":"vae_name","type":"COMBO","widget":{"name":"vae_name"},"link":null},{"localized_name":"t5_name","name":"t5_name","type":"COMBO","widget":{"name":"t5_name"},"link":null},{"localized_name":"clip_name","name":"clip_name","type":"COMBO","widget":{"name":"clip_name"},"link":null},{"localized_name":"prompts_text","name":"prompts_text","type":"STRING","widget":{"name":"prompts_text"},"link":null}],"outputs":[{"localized_name":"sampling_settings","name":"sampling_settings","type":"DICT","links":[361]}],"properties":{"Node name for S&R":"MusubiSamplingSettings","widget_ue_connectable":{}},"widgets_values":[50,0,true,"wan_2.1_vae.safetensors","umt5-xxl-enc-bf16.safetensors","None","A cat surfing a wave --w 512 --h 512"],"color":"#432","bgcolor":"#653"},{"id":136,"type":"Note","pos":[-14758.150390625,-1293.8753662109375],"size":[300.7242736816406,88],"flags":{},"order":7,"mode":0,"inputs":[],"outputs":[],"title":"Clip vision note","properties":{"widget_ue_connectable":{}},"widgets_values":["Clip should be setted up to None for t2v models.\n\nIf you use blocks_to_swap. 28 is the max for 1.3B\nand 38 for the 14B models."],"color":"#432","bgcolor":"#653"},{"id":172,"type":"WanLoRATrainer","pos":[-14377.962890625,-1964.3753662109375],"size":[499.02178955078125,1116],"flags":{},"order":11,"mode":0,"inputs":[{"localized_name":"dataset_config_toml","name":"dataset_config_toml","type":"STRING","link":357},{"localized_name":"trigger_in","name":"trigger_in","type":"*","link":358},{"localized_name":"compile_settings","name":"compile_settings","shape":7,"type":"DICT","link":359},{"localized_name":"memory_settings","name":"memory_settings","shape":7,"type":"DICT","link":360},{"localized_name":"sampling_settings","name":"sampling_settings","shape":7,"type":"DICT","link":361},{"localized_name":"dit_name","name":"dit_name","type":"COMBO","widget":{"name":"dit_name"},"link":null},{"localized_name":"vae_name","name":"vae_name","type":"COMBO","widget":{"name":"vae_name"},"link":null},{"localized_name":"t5_name","name":"t5_name","type":"COMBO","widget":{"name":"t5_name"},"link":null},{"localized_name":"clip_name","name":"clip_name","type":"COMBO","widget":{"name":"clip_name"},"link":null},{"localized_name":"output_dir","name":"output_dir","type":"STRING","widget":{"name":"output_dir"},"link":null},{"localized_name":"output_name","name":"output_name","type":"STRING","widget":{"name":"output_name"},"link":null},{"localized_name":"task","name":"task","type":"COMBO","widget":{"name":"task"},"link":null},{"localized_name":"max_train_steps","name":"max_train_steps","type":"INT","widget":{"name":"max_train_steps"},"link":null},{"localized_name":"learning_rate","name":"learning_rate","type":"FLOAT","widget":{"name":"learning_rate"},"link":null},{"localized_name":"optimizer_type","name":"optimizer_type","type":"COMBO","widget":{"name":"optimizer_type"},"link":null},{"localized_name":"lr_scheduler","name":"lr_scheduler","type":"COMBO","widget":{"name":"lr_scheduler"},"link":null},{"localized_name":"network_module","name":"network_module","type":"COMBO","widget":{"name":"network_module"},"link":null},{"localized_name":"network_dim","name":"network_dim","type":"INT","widget":{"name":"network_dim"},"link":null},{"localized_name":"network_alpha","name":"network_alpha","type":"FLOAT","widget":{"name":"network_alpha"},"link":null},{"localized_name":"network_dropout","name":"network_dropout","type":"FLOAT","widget":{"name":"network_dropout"},"link":null},{"localized_name":"mixed_precision","name":"mixed_precision","type":"COMBO","widget":{"name":"mixed_precision"},"link":null},{"localized_name":"gradient_accumulation_steps","name":"gradient_accumulation_steps","type":"INT","widget":{"name":"gradient_accumulation_steps"},"link":null},{"localized_name":"gradient_checkpointing","name":"gradient_checkpointing","type":"BOOLEAN","widget":{"name":"gradient_checkpointing"},"link":null},{"localized_name":"seed","name":"seed","type":"INT","widget":{"name":"seed"},"link":null},{"localized_name":"attn_mode","name":"attn_mode","type":"COMBO","widget":{"name":"attn_mode"},"link":null},{"localized_name":"split_attn","name":"split_attn","type":"BOOLEAN","widget":{"name":"split_attn"},"link":null},{"localized_name":"fp8_t5","name":"fp8_t5","type":"BOOLEAN","widget":{"name":"fp8_t5"},"link":null},{"localized_name":"vae_dtype","name":"vae_dtype","type":"COMBO","widget":{"name":"vae_dtype"},"link":null},{"localized_name":"max_data_loader_n_workers","name":"max_data_loader_n_workers","type":"INT","widget":{"name":"max_data_loader_n_workers"},"link":null},{"localized_name":"persistent_data_loader_workers","name":"persistent_data_loader_workers","type":"BOOLEAN","widget":{"name":"persistent_data_loader_workers"},"link":null},{"localized_name":"save_every_n_steps","name":"save_every_n_steps","type":"INT","widget":{"name":"save_every_n_steps"},"link":null},{"localized_name":"save_every_n_epochs","name":"save_every_n_epochs","type":"INT","widget":{"name":"save_every_n_epochs"},"link":null},{"localized_name":"save_state","name":"save_state","type":"BOOLEAN","widget":{"name":"save_state"},"link":null},{"localized_name":"scale_weight_norms","name":"scale_weight_norms","type":"FLOAT","widget":{"name":"scale_weight_norms"},"link":null},{"localized_name":"timestep_sampling","name":"timestep_sampling","type":"COMBO","widget":{"name":"timestep_sampling"},"link":null},{"localized_name":"discrete_flow_shift","name":"discrete_flow_shift","type":"FLOAT","widget":{"name":"discrete_flow_shift"},"link":null},{"localized_name":"num_cpu_threads_per_process","name":"num_cpu_threads_per_process","type":"INT","widget":{"name":"num_cpu_threads_per_process"},"link":null},{"localized_name":"max_train_epochs","name":"max_train_epochs","type":"INT","widget":{"name":"max_train_epochs"},"link":null},{"localized_name":"network_args","name":"network_args","shape":7,"type":"STRING","widget":{"name":"network_args"},"link":null},{"localized_name":"optimizer_args","name":"optimizer_args","shape":7,"type":"STRING","widget":{"name":"optimizer_args"},"link":null},{"localized_name":"network_weights","name":"network_weights","shape":7,"type":"STRING","widget":{"name":"network_weights"},"link":null},{"localized_name":"training_comment","name":"training_comment","shape":7,"type":"STRING","widget":{"name":"training_comment"},"link":null}],"outputs":[{"localized_name":"lora_filepath","name":"lora_filepath","type":"STRING","links":[362]},{"localized_name":"status_message","name":"status_message","type":"STRING","links":[363]}],"properties":{"Node name for S&R":"WanLoRATrainer","widget_ue_connectable":{}},"widgets_values":["Wan14BT2VFusioniX_fp16_.safetensors","wan_2.1_vae.safetensors","umt5-xxl-enc-bf16.safetensors","None","full_path_for_the_output_dir","my_lora_wan","t2v-14B",2048,0.0002,"AdamW8bit","cosine","networks.lora_wan",32,1,0,"fp16",1,true,1730,"randomize","xformers",false,false,"float16",2,true,0,1,false,1,"shift",3,8,128,"","","",""],"color":"#233","bgcolor":"#355"}],"links":[[351,169,0,170,0,"STRING"],[352,170,0,171,0,"STRING"],[353,170,1,171,1,"*"],[354,169,1,170,1,"*"],[355,170,2,128,0,"STRING"],[356,171,2,129,0,"STRING"],[357,171,0,172,0,"STRING"],[358,171,1,172,1,"*"],[359,173,0,172,2,"DICT"],[360,174,0,172,3,"DICT"],[361,175,0,172,4,"DICT"],[362,172,0,130,0,"STRING"],[363,172,1,131,0,"STRING"]],"groups":[{"id":1,"title":"PRE-CACHING. YOU CAN SKIP AFTER GENERATION.","bounding":[-15731.8359375,-2196.345458984375,920.3976440429688,636.7136840820312],"color":"#8A8","font_size":24,"flags":{}},{"id":2,"title":"TRAINING","bounding":[-14796.2548828125,-2192.201171875,1343.2088623046875,1353.873779296875],"color":"#8AA","font_size":24,"flags":{}},{"id":3,"title":"TOM AUTO-GEN__ Always ON for trigger","bounding":[-16367.0068359375,-2190.798583984375,620.541748046875,627.3327026367188],"color":"#b06634","font_size":24,"flags":{}}],"config":{},"extra":{"ds":{"scale":0.8954302432553165,"offset":[16544.2679183969,2172.964835865512]},"ue_links":[],"links_added_by_ue":[]},"version":0.4}